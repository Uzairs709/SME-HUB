<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="Signup.css" />
    <script
      src="https://unpkg.com/@dotlottie/player-component@latest/dist/dotlottie-player.mjs"
      type="module"
    ></script>
    <script
      src="https://unpkg.com/@dotlottie/player-component@latest/dist/dotlottie-player.mjs"
      type="module"
    ></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.3/firebase-firestore.js"></script>

    <title>Sign Up</title>
  </head>
  <body>
    <form>
      <div class="Signup-Container">
        <div class="signup-image">
          <dotlottie-player
            src="https://lottie.host/5c01ca40-3a20-4297-b368-33762f2142ef/YQx8pOD24t.json"
            background="transparent"
            speed="1"
            class="animation"
            loop
            autoplay
          ></dotlottie-player>
        </div>
        <div class="signup-separator"></div>
        <div class="Signup-Form">
          <h1 class="log">Sign Up</h1>
          <div class="form-container">
            <label for="name"></label>
            <input
              type="text1"
              id="name"
              name="name"
              placeholder="Name"
              required
            />
          </div>
          <div class="form-container">
            <label for="email"></label>
            <input
              type="email"
              id="email"
              name="email"
              placeholder="Email"
              required
            />
          </div>
          <div class="form-container">
            <label for="password"></label>
            <input
              type="password"
              id="password"
              name="password"
              placeholder="Password"
              required
            />
            <label for="confirmPassword"></label>
            <input
              type="password"
              id="confirmPassword"
              name="confirmPassword"
              placeholder="Confirm Password"
              required
            />
          </div>
          <div class="form-container">
            <label for="username"></label>
            <input
              type="text"
              id="username"
              name="username"
              placeholder="Username"
              required
            />
            <label for="phone"></label>
            <input
              type="tel"
              id="phone"
              name="phone"
              placeholder="Phone Number"
              required
            />
          </div>
          <div class="form-container">
            <label for="organization"></label>
            <input
              type="text"
              id="organizationName"
              name="organization"
              placeholder="Organization Name"
              required
            />
            <label for="organizationWebsite"></label>
            <input
              type="url"
              id="organizationWebsite"
              name="organizationWebsite"
              placeholder="Organization Website"
              required
            />
          </div>
          <div class="form-container">
            <label for="description"></label>
            <textarea
              id="businessDescription"
              class="bd"
              placeholder="Bussiness Description"
            ></textarea>
          </div>
          <button type="submit" onclick="signup()">Signup</button>
          <p class="new">
            Already have an account?<a
              href="Login.html "
              style="display: inline"
            >
              Login</a
            >
          </p>
        </div>
      </div>
    </form>
    <!-- SCRIPT START HERE -->

    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.3/firebase-app.js";
      import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
      } from "https://www.gstatic.com/firebasejs/9.6.3/firebase-auth.js";
      import {
        getFirestore,
        collection,
        addDoc,
        query,
        where,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/9.6.3/firebase-firestore.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDkFhkVRw7-AcuAPRelSXFhLIjmpK1pZz0",
        authDomain: "sme-hub-603b5.firebaseapp.com",
        projectId: "sme-hub-603b5",
        storageBucket: "sme-hub-603b5.appspot.com",
        messagingSenderId: "582885271965",
        appId: "1:582885271965:web:c8e58007444c2a3f88e774",
        measurementId: "G-N3B4XZT9LC",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      function signup() {
        console.log("IN functions");
        const name = document.getElementById("name").value.trim();
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();
        const confirmPassword = document
          .getElementById("confirmPassword")
          .value.trim();
        const username = document.getElementById("username").value.trim();
        const phone = document.getElementById("phone").value.trim();
        const organization = document
          .getElementById("organization")
          .value.trim();
        const organizationWebsite = document
          .getElementById("organizationWebsite")
          .value.trim();
        const businessDescription = document
          .getElementById("businessDescription")
          .value.trim();

        // Input validation
        let isValid = true;
        const errorMessage = [];

        if (name.length === 0) {
          errorMessage.push("Please enter your name.");
          isValid = false;
        }

        if (!validateEmail(email)) {
          errorMessage.push("Please enter a valid email address.");
          isValid = false;
        }

        if (password.length < 8) {
          errorMessage.push("Password must be at least 8 characters long.");
          isValid = false;
        } else if (password !== confirmPassword) {
          errorMessage.push("Passwords do not match.");
          isValid = false;
        }

        // Additional input validation for phone number, username format, etc. (optional)

        if (!isValid) {
          alert(errorMessage.join("\n"));
          return;
        }

        // Check for existing user
        const usersRef = collection(db, "users");
        const q = query(usersRef, where("email", "==", email));

        getDocs(q)
          .then((querySnapshot) => {
            if (!querySnapshot.empty) {
              alert(
                "Email address already in use. Please choose a different one."
              );
              return;
            }

            const user = userCredential.user;
            // Add user data to Firestore
            addDoc(collection(db, "users"), {
              name,
              email,
              username,
              phone,
              organization,
              organizationWebsite,
              businessDescription,
              // Add any additional user profile fields as needed
            })
              .then(() => {
                alert("Account created successfully! You can now log in.");
                // Redirect user to login page or other success action
              })
              .catch((error) => {
                console.error("Error adding user data:", error);
                alert("An error occurred. Please try again later.");
              });
          })
          .catch((error) => {
            console.error("Error checking for existing user:", error);
            alert(
              "An error occurred while checking user availability. Please try again later."
            );
          });
      }

      // Function to validate email format
      function validateEmail(email) {
        const re =
          /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(String(email).toLowerCase());
      }
    </script>
  </body>
</html>
